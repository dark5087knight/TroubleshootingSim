#!/usr/bin/env bash

set -e

APP_NAME="labctl"
INSTALL_DIR="/opt/$APP_NAME"
BIN_LINK="/usr/local/bin/$APP_NAME"
TREE_JSON_URL="https://raw.githubusercontent.com/dark5087knight/TroubleshootingScenarios/main/tree.json"

echo "LabCTL Installation Wizard"
echo "----------------------------------"

# Check for root
if [[ $EUID -ne 0 ]]; then
  echo "Please run as root (use sudo)"
  exit 1
fi

# Check Python
if ! command -v python3 &>/dev/null; then
  echo "Python3 is not installed"
  exit 1
fi

echo "Python3 detected"

# Create install directory
echo "Installing to $INSTALL_DIR"
mkdir -p "$INSTALL_DIR"

# Copy local engine and main.py
echo "Copying application files..."
cp -r engine main.py README.md "$INSTALL_DIR"

# Download tree.json from GitHub
echo "Downloading latest tree.json from GitHub..."
curl -fsSL "$TREE_JSON_URL" -o "$INSTALL_DIR/tree.json"

# Ensure executable
chmod +x "$INSTALL_DIR/main.py"

# Create symlink
echo "Creating global command: $APP_NAME"
ln -sf "$INSTALL_DIR/main.py" "$BIN_LINK"

echo ""
echo " Installation complete!"
echo ""
